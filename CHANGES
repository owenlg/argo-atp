##############################################################################
#
# NAME:        CHANGES
#
# FACILITY:    SAM (Service Availability Monitoring)
#
# COPYRIGHT:
#         Copyright (c) 2009, Members of the EGEE Collaboration.
#         http://www.eu-egee.org/partners/
#         Licensed under the Apache License, Version 2.0.
#         http://www.apache.org/licenses/LICENSE-2.0
#         This software is provided "as is", without warranties
#         or conditions of any kind, either express or implied.
#
# DESCRIPTION:
#
#
# AUTHORS:     David Collados, CERN
#              Joshi Pradyumna, BARC
#
# CREATED:     23-Nov-2009
#
# NOTES:
#
# MODIFIED:
#
##############################################################################
* Fri Jun 10 2011 Joshi Pradyumna<pjoshi@cern.ch> - 1.17.1-1%{?dist}
- SAM-1500 ROC 'Italy' present in ACE EGI League
- SAM-1513 Wrong availability and reliability number for few federations in ACE WLCG Tier-2 report
- SAM-1514 Wrong availability and reliability number for federation US-LBNL-ALICE in ACE WLCG Tier-2 report
- SAM-1509 WLCG Tier2 report - wrong numbers for CPUs and HS06.
- SAM-1502 Sites UB_LCG2 and CSC present in ACE WLCG Tier-2 report 
- SAM-1571 ATP: during the synchronizer execution a temporary table is created and/or dropped
- SAM-1559 Improvement to atp_synchro.conf 
- SAM-1440 ATP: regional instances should only store topology of their region
- SAM-1510 Site prague_cesnet_lcg2 is only in ACE WLCG Tier-2 report
- SAM-1503 EGI League - sites from NGI_IE present also as UKI sites
- SAM-1467 ACE is showing (and computing?) availabilities for sites which changed names or migrated services to other site

* Wed May 25 2011 Joshi Pradyumna<pjoshi@cern.ch> - 1.16.9-7%{?dist}
- SAM-1579 ATP synchronizer failing due to change in GOCDB
- SAM-1574 Error - local variable 'lfc_ops_service' referenced before assignment
- SAM-1559 Improvement to atp_synchro.conf 
- SAM-1456 Switch to new Operations portal VO card PI
* Thu May 5 2011 Joshi Pradyumna<pjoshi@cern.ch> - 1.16.9-5%{?dist}
- SAM-1442 Fresh installation of oracle-ATP using nightly validation machine
* Mon May 2 2011 Joshi Pradyumna<pjoshi@cern.ch> - 1.16.9-4%{?dist}
- SAM-1431 Investigate ATP setup on NGI instances
* Fri Apr 29 2011 Joshi Pradyumna<pjoshi@cern.ch> - 1.16.9-3%{?dist}
- SAM-1462 ACE/GridView - downtime start and endtime treated differenty 
* Fri Apr 29 2011 Joshi Pradyumna<pjoshi@cern.ch> - 1.16.9-2%{?dist}
- SAM-1442 Fresh installation of oracle-ATP using nightly validation machine
* Wed Mar 23 2011 Joshi Pradyumna<pjoshi@cern.ch> - 1.16.8-7%{?dist}
- SAM-1361 ATP - error while extracting KSI2K values from the OIM feed
* Tue Mar 15 2011 Joshi Pradyumna<pjoshi@cern.ch> - 1.16.8-6%{?dist}
- SAM-1124 ATP - OSG downtime creation, modification or deletion (OIM->ATP)
* Tue Mar 8 2011 Joshi Pradyumna<pjoshi@cern.ch> - 1.16.8-4%{?dist}
- SAM-1280 atp - problem with CMS feed
- SAM-1241 ATP: support any group type & group name defined in a VO feed
* Mon Feb 28 2011 Joshi Pradyumna<pjoshi@cern.ch> - 1.16.8-3%{?dist}
- SAM-1309 ATP: DB upgrade to 1.9 - problem when creating from scratch
* Sun Feb 27 2011 Joshi Pradyumna<pjoshi@cern.ch> - 1.16.8-1%{?dist}
- SAM-1233 NDGF-T1 services do not appear in the Tier 1 and federation grouping in ATP
- SAM-1281 ATP: OSG downtimes aren't synchronized in MySQL and Oracle version
- SAM-1154 ATP: OSG downtime IDs are not propagated into the DB

* Fri Feb 11 2011 Joshi Pradyumna<pjoshi@cern.ch> - 1.16.7-3%{?dist}
-SAM-1266 ATP: OSG sites are marked as not certified

* Fri Feb 4 2011 Joshi Pradyumna<pjoshi@cern.ch> - 1.16.7-2%{?dist}
- SAM-1229 ATP: missing VO mappings to services when using servicemap JSON feed 
* Fri Feb 4 2011 Joshi Pradyumna<pjoshi@cern.ch> - 1.16.7-1%{?dist}
- SAM-1229 (ATP: missing VO mappings to services when using servicemap JSON feed
- SAM-1230 Installed capacity information in site_store_cap table is not correct

* Mon Jan 31 2011 Joshi Pradyumna<pjoshi@cern.ch> - 1.16.6-5%{?dist}
- SAM-1209 ATP - ROC_NAME is null for MPI services 
- SAM-1204 ATP: MPI services are not mapped to any site 
* Tue Jan 25 2011 Joshi Pradyumna<pjoshi@cern.ch> - 1.16.6-4%{?dist}
- SAM -1186 ATP: error in Oracle MPI_SERVICES_UPDATE procedure
- IS-186 modified GSTAT url in atp_synchro.conf 
* Fri Jan 21 2011 Joshi Pradyumna<pjoshi@cern.ch> - 1.16.6-3%{?dist}
- SAM-1132 ATP: config_atp incorrectly configures grid-monitoring box
- SAM-1159 Change GOCDB address to goc.egi.eu 
- SAM-1041 ATP: errors updating GOCDB downtimes 
- SAM-1137 ATP: config.logger.error 

* Mon Jan 17 2011 Joshi Pradyumna<pjoshi@cern.ch> - 1.16.6-1%{?dist}
- SAM-1114 ATP: Error in inserting/updating downtimes in atp logs
- SAM-1014 ATP-WEB:ROC name in VO feeds
- SAM-989 ATP: Integrate OPS Tiers information from GStat into ATP
- SAM-988 ATP: Integrate Federations info to generate WLCG reports
- SAM-811 ATP: site_store_cap table should include HSPEC06 numbers instead of KSI2K (or both)
- SAM-413 ATP: automatic groups of MPI services in DB for OPS VO
- SAM-365 ATP: BDII synchronizer should fill CE metadata for MPIs in DB
 
* Wed Dec 15 2010 Joshi Pradyumna<pjoshi@cern.ch> - 1.16.4-3%{?dist}
- SAM-971:ATP: vo_goup table should have mappings for OPS
- AMGA service already defined in ATP ver_1_6. Removed entry from migration scripts:from_1_6_to_1_7.sql.

* Wed Dec 15 2010 David Collados <dcollado@cern.ch> - 1.16.4-1%{?dist}
- SAM-1047: ATP: db migration scripts from 1.6 to 1.7 in Oracle & Mysql 
contain servicetype table name instead of service_type

* Tue Dec 14 2010 Joshi Pradyumna <pjoshi@cern.ch> - 1.16.3-1%{?dist}
- SAM-1036: Site entries in SERVICE_GROUP table should to be moved to VO_SERVICE_GROUP table

* Mon Dec 13 2010 David Collados <dcollado@cern.ch> - 1.16.3-1%{?dist}
- SAM-450:  Update list of Service Types and Service Type Flavours
- SAM-1018: ATP: map VOs supporting srmv1 & srmv2 services while reading the BDII to srm service type flavour too
- SAM-1026: atp schema migrate 1.6 to 1.7 in update-08
- SAM-1027: ATP: update spec file to include DB ver 1.7 (currently set to 1.6)

* Fri Dec 10 2010 David Collados <dcollado@cern.ch> - 1.16.2-1%{?dist}
- SAM-961:  ATP: when querying the BDII for service-vo mappings some of the service type flavours used for mappings are wrong and should be updated
- SAM-971:  ATP: vo_goup table should have mappings for OPS
- SAM-984:  atp package should not require MySQL
- SAM-1007: Unique constraint in schema_details table
- SAM-1011: ATP: include srmv2 in the db_mapping_gocdb_bdii_serv_type table in atp config file
- SAM-1017: ATP synchronizer fails to run

* Wed Dec 8 2010 David Collados <dcollado@cern.ch> - 1.16.1-1%{?dist}
- SAM-960:  VOs synchronizer should not delete VOs when they are not anymore in 
            the CIC list, but just mark them as 'deleted'
- SAM-996:  improve error output in VO_TOPOLOGY_UPDATE procedure when the service is not found in the DB
- SAM-1003: ATP: remove OPS VO mapping for central-LFCs when synchronizing from GOCDB or OIM
- SAM-1005: VO_TOPOLOGY_UPDATE procedure should not insert/modify groups or 
            group_type tables if service is not found in the DB

* Thu Nov 25 2010 Joshi Pradyumna <pjoshi@cern.ch> - 1.15.6-1%{?dist}
- fixed  SAM-954 - atp-web service does not start
* Thu Nov 25 2010 Joshi Pradyumna <pjoshi@cern.ch> - 1.15.5-1%{?dist}
- fixed SAM-931 Service flapping from SRMv2 to SRM and back
- fixed SAM-951 ATP MySQL schema modified for case-insensitive search in django

* Mon Oct 25 2010 David Collados <david.collados@cern.ch> - 1.15.4-1%{?dist}
- fixed SAM-875

* Wed Oct 20 2010 David Collados <david.collados@cern.ch> - 1.15.3-1%{?dist}
- atp-web feed fix for SAM-832
- fix to store CPU numbers when no HEPSPEC06 number is passed

* Mon Oct 18 2010 David Collados <david.collados@cern.ch> - 1.15.2-1%{?dist}
- Changes for SAM Update 06 release

* Mon Sep 27 2010 David Collados <david.collados@cern.ch> - 1.15.1-4%{?dist}
- Updated VO_TOPOLOGY_UPDATE, SITE_UPDATE & SERVICE_UPDATE proc to fix
  update of services when GOCDB changes their PK

* Fri Sep 24 2010 David Collados <david.collados@cern.ch> - 1.15.1-3%{?dist}
- Fixed synchronizer execution time, so services are not removed by the cron job

* Tue Sep 21 2010 David Collados <david.collados@cern.ch> - 1.15.1-2%{?dist}
- ATP for single DB including schema_details table.

* Thu Sep 02 2010 James Casey <james.casey@cern.ch> - 1.14.2-2%{?dist}
- dos2unix on atp_synchro.conf to trigger .rpmnew

* Fri Aug 27 2010 James Casey <james.casey@cern.ch> - 1.14.3-1%{?dist}
- And make sure the schema is actually installed ;(

* Fri Aug 27 2010 James Casey <james.casey@cern.ch> - 1.14.2-1%{?dist}
- SAM-768: Django tables don't use InnoDB by default

* Thu Aug 26 2010 James Casey <james.casey@cern.ch> - 1.14.1-1%{?dist}
- Bugfixes

* Wed Aug 25 2010 James Casey <james.casey@cern.ch> - 1.14.0-1%{?dist}
- Repackaging to make it slightly more pythonic
- Added python-django-db-schema for deps

Version 1.13-1 Tue Aug 24 2010 Joshi Pradyumna <pjoshi@cern.ch>
- Fixed bug #SAM-637 ATP: SITE_UPDATE procedure in db_migrate_schema from_1_2_to_1_3.sql has twice 'create or replace
- Fixed bug #SAM-722 Problem with function atp.get_roc_name or wrong association with ROC/NGI
- Fixed bug #SAM-385 ATP - problem with SRMv2/SRMv1 services
- Fixed bug #SAM-497 ATP: atp_synchro sets type of some SRMv2 services to 'SRMv1'
- Fixed bug #SAM-709 ATP: ldap_uri hardcoded in 'atp_synchro.conf' configuration file
- New Feature - ATP: write database procedures/functions that returns site/services for a given experiment VO and Tier

Version 1.10-1 - Sat Mar 20 David Collados <david.collados@cern.ch>
  - Patch #3931: https://savannah.cern.ch/patch/?3931
  - Fixed bug #64538: ATP: Synchronizer_lastrun table is not formalized
  - Fixed bug #64542: ATP: schema_details table should go out of ATP
  - Fixed bug #64537: ATP: should support GOCDB-4
  - Fixed bug #63538: ATP: Missing CE metadata for MPIs in the database
  - Fixed bug #63820: ATP: SRM services in GOCDB are not registered in ATP
  - Fixed bug #63822: ATP: service last seen is updated even if the transaction failed
  - Fixed bug #64163: ATP: add function get_site_name(service_id)


Version 1.8.12 - Thu Jan 14 2010 David Collados <David.Collados@cern.ch>
  - Feature request. Interface to extract VO specific topology information
    https://savannah.cern.ch/bugs/?59239
  - Feature request. Interface to extract downtimes of sites and services 
    from a VO point of view
    https://savannah.cern.ch/bugs/?59963

Version 1.8.11 - Wed Jan 13 2010 David Collados <David.Collados@cern.ch>
  - Fixed bug marking sites as deleted when have no services associated
    https://savannah.cern.ch/bugs/index.php?59923

Version 1.8.3 - Thu Dec 10 2009 David Collados <David.Collados@cern.ch>
  - Add new group to cover the new ROC_IGALC ROC
    https://savannah.cern.ch/bugs/?60463
  - Added header description & copyright to source files
    https://savannah.cern.ch/bugs/?60608

Version 1.8.2 - Thu Dec 05 2009 David Collados <David.Collados@cern.ch>
  - fixed atp-web package (had no code):
    https://savannah.cern.ch/bugs/?57581
  - web search function returns inconsistent result depending on severity:
    https://savannah.cern.ch/bugs/?59244
  - mysql event scheduler uses wrong db name:
    https://savannah.cern.ch/bugs/?59390
  - synchronizer config.py does not define 'logger' attribute:
    https://savannah.cern.ch/bugs/?59406
  - Change requirement of python-yaml to PyYAML:
    https://savannah.cern.ch/bugs/?59579
  - wrong arguments when calling SITE_KSI2K_UPDATE:
    https://savannah.cern.ch/bugs/?59628

Version 1.8.1 - Tue Nov 10 2009 Steve Traylen <steve.traylen@cern.ch>
  - Can't have more than one ATP per broker network:
    https://savannah.cern.ch/bugs/?58577
  - Includes synchroLastrun method, uses a unique topic name:
    https://savannah.cern.ch/bugs/?58590

Version 1.7 - Tue Nov 10th 2009 Steve Traylen <steve.traylen@cern.ch>
  - Addition of mysql scehema_details.
  - Change program to have unix line feeds.

Version 1.6 - Tue Nov 3rd 2009 Steve Traylen <steve.traylen@cern.ch>
  - Rename of sychonized to atp_sychonizer.

Version 1.5 - Thu Oct 22nd 2009 Steve Traylen <steve.traylen@cern.ch>
  - Rename httpd configuration to xatp_django.conf to load after
    wsgi.conf

Version 1.4 - Wed Oct 21st 2009 Steve Traylen <steve.traylen@cern.ch>
  - Add check_atp_sync

Version 1.3 - Tue Oct 18th 2009 Steve Traylen <steve.traylen@cern.ch>
  -   Change default certificate locations to where we have
      them for nagios anyway.

Version 1.2 - Tue Oct 18th 2009 Steve Traylen <steve.traylen@cern.ch>
  -   Hard code a log file to /var/log/atp/atp.log to be improved later

Version 1.1 - Tue Oct 18th 2009 Steve Traylen <steve.traylen@cern.ch>
  -   Move the database connection parameters to a secondary file 
      /etc/atp/atp_db.conf
  -   Make the import of cx_Oracle or MySQLdb conditiononal on 
      the configuration.
